<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Labeling - ArcanNN - Training</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Labeling";
        var mkdocs_page_input_path = "usage/labeling.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> ArcanNN - Training
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Getting started</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../getting-started/requirements/">ArcaNN Requirements</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../getting-started/installation/">ArcaNN Installation Guide</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../getting-started/hpc_configuration/">HPC Configuration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Usage</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../start/">Using ArcaNN</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../iter_prerequisites/">Iterative procedure prerequisites</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../initialization/">Initialization</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../training/">Training</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../exploration/">Exploration</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Labeling</a>
    <ul class="current">
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../test/">Test</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Examples</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../examples/sn2/">SN2</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Contributions</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../contributions/unexpected_behavior/">Unexpected Behavior</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../contributions/contributions/">Contributions</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Project details</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../project_details/license/">License</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../project_details/authors/">Authors</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../project_details/funding/">Funding</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../project_details/acknowledgments/">Acknowledgments</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">ArcanNN - Training</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Usage</li>
      <li class="breadcrumb-item active">Labeling</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="labeling">Labeling</h1>
<p>In the labeling phase we will use the CP2K code to compute the electronic energies, atomic forces and (sometimes) the stress tensor of the candidate configurations obtained in the exploration phase.</p>
<p>In the case you are performing the labeling step in a different HPC machine, don't forget to copy the data (you must also install the ArcaNN software and create a python environment!) beforehand:</p>
<pre><code class="language-bash">rsync -rvu $WORK_DIR USER@OTHER_HPC_MACHINE:PATH_TO_WORKDIR
</code></pre>
<p>For this we need to go to the <code>XXX-labeling</code> folder and as usual run the <code>prepare</code> phase. It is very important to have a look at the <code>default_input.json</code> of the <code>prepare</code> phase to choose the computational resources to be used in the electronic structure calculations (number of nodes and MPI/OpenMP tasks). Note that the default values are insufficient for most condensed systems (due to the large number of atoms), so you should have previously determined the resources required by your specific system(s). </p>
<pre><code class="language-JSON">{
    &quot;step_name&quot;: &quot;labeling&quot;,
    &quot;user_machine_keyword_label&quot;: &quot;mykeyword1&quot;,
    &quot;job_email&quot;: &quot;&quot;,
    &quot;walltime_first_job_h&quot;: [0.5, 0.5, 0.5],
    &quot;walltime_second_job_h&quot;: [1.0, 1.0, 1.5],
    &quot;nb_nodes&quot;: [1, 1, 1],
    &quot;nb_mpi_per_node&quot;: [32, 32, 64],
    &quot;nb_threads_per_mpi&quot;: [2, 2, 2],
}
</code></pre>
<p>The <code>"use_machine_keyword_label"</code> keyword corresponds to the partition in the HPC machine, The <code>"nb_mpi_per_node"</code> and <code>"nb_nodes"</code> keywords set the number of CPU nodes used for the labeling. The wall times should be set for the first iteration but can be guessed automatically later using the average time per CP2K calculation measured in the previous iteration. </p>
<p>Once you have executed this phase, folders will have been created for each subsystem within which there will be as many folders as candidate configurations (maximum number of 99999 per iteration), containing all required files to run CP2K. Make sure that you have prepared (and correctly named!) Slurm submission files for your machine in the <code>$WORK_DIR/user_files/</code> folder (see <a href="../initialization">Initialization</a>), from the template files. </p>
<p>For CP2K calculations, 2 scripts must be prepared : a first quick calculation at a lower level of theory and then a second one at our reference level.</p>
<p>You can then submit the calculations by executing the <code>launch</code> phase. Once these are finished you can check the results with  the <code>check</code> phase. Since candidate configurations are not always very stable (or even physically meaningful if you were too generous with deviation thresholds) some DFT calculations might not have converged. This will be indicated in the output of the <code>check</code> phase.  You can either perform manually the calculations with a different setup until the result is satisfactory or skip the problematic configurations by creating empty <code>skip</code> files in the folders that should be ignored. Keep running <code>check</code> until you get a "Success!" message. Use the <code>extract</code> phase to set up everything for the training phase and eventually run the <code>clean</code> phase to clean up your folder. CP2K wavefunctions might be stored in an archive with a command given by the code that must be executed manually (if one wishes to keep these files as, for example, starting points for higher level calculations). You can also delete all files but the archives created by the code if you want. We have now augmented our total training set and might do a new training iteration and keep iterating until convergence is reached!</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../exploration/" class="btn btn-neutral float-left" title="Exploration"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../test/" class="btn btn-neutral float-right" title="Test">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../exploration/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../test/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
